## 2장 테스트 환경 구성하기

**코드형 인프라(IaC, Infrastructure as Code)**

### 테스트 환경을 자동으로 구성하는 도구

*(책에서는  Virtual Box로 VM을 생성하고, 베이그런트로 프로비저닝을 진행한다.)*

- 프로비저닝이란 사용자의 요구에 맞게 시스템 자원을 할당, 배치, 배포해 두었다가 필요할 때 시스템을 사용할 수 있는 상태로 만드는 것 → 코드형 인프라

굳이 베이그런트로 하지 않고, 책에 나온 설정들을 도커 파일에 담아서 컨테이너 형태로 구동시켜보자.

### 베이그런트로 테스트 환경 구축하기

“가상 머신의 이름, CPU 수, 메모리 크기, 소속된 그룹을 명시”

- 도커에서는 CPU, 메모리, Block I/O 등을 제한할 수 있다.

“호스트 전용 네트워크 설정, IP 지정, SSH 통신,디렉터리 동기화”

- `docker network ls`
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1dbf8a9a-7b96-4620-b9b9-93b6bf0b0be8/Untitled.png)
    
    - 현재 생성되어 있는 Docker 네트워크 목록을 조회
- 다양한 종류의 드라이버 지원
    - `bridge` 네트워크는 하나의 호스트 컴퓨터 내에서 여러 컨테이너들이 서로 소통할 수 있도록 해줍니다.
    - `host` 네트워크는 컨터이너를 호스트 컴퓨터와 동일한 네트워크에서 컨테이너를 돌리기 위해서 사용됩니다.
    - `overlay` 네트워크는 여러 호스트에 분산되어 돌아가는 컨테이너들 간에 네트워킹을 위해서 사용됩니다.

### 도커 파일 작성

- 컨테이너를 VM처럼 쓰기 위한 가르침 ([참고 링크](https://www.popit.kr/%EA%B0%9C%EB%B0%9C%EC%9E%90%EA%B0%80-%EC%B2%98%EC%9D%8C-docker-%EC%A0%91%ED%95%A0%EB%95%8C-%EC%98%A4%EB%8A%94-%EB%A9%98%EB%B6%95-%EB%AA%87%EA%B0%80%EC%A7%80/))
    - Docker 컨테이너는 단지 명령만 실행하고 그 결과만 보여주는 기능을 수행한다.
    - `/bin/bash -c "while true; do echo "still alive"; sleep 100; done"`
        - 위 명령어가 계속 실행되는 컨테이너에 `docker attach`를 통해 컨테이너에 접속하여 100초마다 still alive를 출력하는 것을 볼수도 있고,
        - `docker exec` 를 통해 추가적인 명령어를 실행할 수 있다.
        - 추가로 `CMD tail -f /dev/null`

가상 머신 총 4대를 구성한다. 그리고 가상 머신 간에 네트워크 통신이 원활하게 작동하는지 확인